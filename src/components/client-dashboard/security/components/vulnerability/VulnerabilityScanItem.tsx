import React, { useState } from "react";
import { Card } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { ChevronDown, ChevronUp } from "lucide-react";
import { VulnerabilityScan } from "../../types";
import { ScanHeader } from "../shared/ScanHeader";
import { FindingDetails } from "./FindingDetails";

interface VulnerabilityScanItemProps {
  scan: VulnerabilityScan;
}

export const VulnerabilityScanItem = ({ scan }: VulnerabilityScanItemProps) => {
  const [isExpanded, setIsExpanded] = useState(false);

  return (
    <Card className="p-4 space-y-4">
      <ScanHeader 
        scanType={scan.scan_type}
        startTime={scan.start_time}
        endTime={scan.end_time}
        totalVulnerabilities={scan.total_vulnerabilities}
        status={scan.status}
      />

      <div className="grid grid-cols-2 gap-4">
        <div>
          <p className="text-sm font-medium">Total Vulnerabilities</p>
          <p className="text-2xl font-bold">{scan.total_vulnerabilities}</p>
        </div>
        <div>
          <p className="text-sm font-medium">Severity Breakdown</p>
          <div className="space-y-1">
            <p className="text-xs">Critical: {scan.severity_breakdown.critical}</p>
            <p className="text-xs">High: {scan.severity_breakdown.high}</p>
            <p className="text-xs">Medium: {scan.severity_breakdown.medium}</p>
            <p className="text-xs">Low: {scan.severity_breakdown.low}</p>
          </div>
        </div>
      </div>

      {scan.findings && scan.findings.length > 0 && (
        <Button
          variant="outline"
          className="w-full mt-2"
          onClick={() => setIsExpanded(!isExpanded)}
        >
          {isExpanded ? (
            <ChevronUp className="h-4 w-4 mr-2" />
          ) : (
            <ChevronDown className="h-4 w-4 mr-2" />
          )}
          {isExpanded ? "Hide" : "Show"} Detailed Findings
        </Button>
      )}

      {isExpanded && scan.findings && (
        <div className="space-y-4 mt-4 border-t pt-4">
          {scan.findings.map((finding) => (
            <FindingDetails key={finding.id} finding={finding} />
          ))}
        </div>
      )}
    </Card>
  );
};